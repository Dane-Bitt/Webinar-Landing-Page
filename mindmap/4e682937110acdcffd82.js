!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"==typeof globalThis?t||self:globalThis).WZoom=e()}(this,(function(){"use strict";var t=Math.min,e=Math.abs;function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,s=[],r=!0,h=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(s.push(i.value),!e||s.length!==e);r=!0);}catch(t){h=!0,o=t}finally{try{r||null==n.return||n.return()}finally{if(h)throw o}}return s}}(t,e)||i(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function s(t){var e=t.getBoundingClientRect(),n=document,i=n.body,o=n.documentElement,s=window.pageYOffset||o.scrollTop||i.scrollTop,r=window.pageXOffset||o.scrollLeft||i.scrollLeft,h=o.clientTop||i.clientTop||0,c=o.clientLeft||i.clientLeft||0;return{top:e.top+s-h,left:e.left+r-c}}function r(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function h(t,e,n){var i=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];t.addEventListener(e,n,i)}function c(t,e,n){var i=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];t.removeEventListener(e,n,i)}function l(){return"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints}function a(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientX:t.changedTouches[0].clientX}function u(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientY:t.changedTouches[0].clientY}function p(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this._dropHandler=this._dropHandler.bind(this),this._grabHandler=this._grabHandler.bind(this),this._moveHandler=this._moveHandler.bind(this),n.smoothExtinction=+n.smoothExtinction,isNaN(n.smoothExtinction)&&(n.smoothExtinction=.25),this.options=r({smoothExtinction:.25,onGrab:null,onMove:null,onDrop:null},n),this.isTouch=l(),this.events=this.isTouch?{grab:"touchstart",move:"touchmove",drop:"touchend"}:{grab:"mousedown",move:"mousemove",drop:"mouseup"},this.events.options=!!this.isTouch&&{passive:!1},this.window=t,this.content=e,h(this.content.$element,this.events.grab,this._grabHandler,this.events.options)}function d(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this._init=this._init.bind(this),this._prepare=this._prepare.bind(this),this._computeNewScale=this._computeNewScale.bind(this),this._computeNewPosition=this._computeNewPosition.bind(this),this._transform=this._transform.bind(this),this._wheelHandler=m.bind(this),this._downHandler=f.bind(this),this._upHandler=g.bind(this),this._zoomTwoFingers_TouchmoveHandler=w.bind(this),this._zoomTwoFingers_TouchendHandler=v.bind(this),this.content={},this.window={},this.isTouch=!1,this.events=null,this.direction=1,this.options=null,this.dragScrollable=null,this.coordsOnMouseDown=null;var n={type:"image",width:null,height:null,dragScrollable:!0,dragScrollableOptions:{},minScale:null,maxScale:1,speed:50,zoomOnClick:!0,watchImageChange:!0,smoothExtinction:.3,alignContent:"center",disableWheelZoom:!1};if("string"==typeof t)this.content.$element=document.querySelector(t);else{if(!(t instanceof HTMLElement))throw"WZoom: `selectorOrHTMLElement` must be selector or HTMLElement, and not ".concat({}.toString.call(t));this.content.$element=t}if(this.isTouch=l(),this.events=this.isTouch?{down:"touchstart",up:"touchend"}:{down:"mousedown",up:"mouseup"},this.events.options=!!this.isTouch&&{passive:!0},this.content.$element)if(e.smoothExtinction=+e.smoothExtinction,isNaN(e.smoothExtinction)&&(e.smoothExtinction=n.smoothExtinction),this.options=r(n,e),this.options.minScale&&this.options.minScale>=this.options.maxScale&&(this.options.minScale=null),this.window.$element=this.content.$element.parentNode,"image"===this.options.type){var i=!1;this.content.$element.complete&&(this._init(),i=!0),i&&!0!==this.options.watchImageChange||h(this.content.$element,"load",this._init,!this.options.watchImageChange&&{once:!0})}else this._init()}function m(t){this.options.disableWheelZoom||(t.preventDefault(),this._transform(this._computeNewPosition(this._computeNewScale(t.deltaY),{x:a(t),y:u(t)})))}function f(t){(this.isTouch&&1===t.touches.length||1===t.buttons)&&(this.coordsOnMouseDown={x:a(t),y:u(t)})}function g(t){this.coordsOnMouseDown&&this.coordsOnMouseDown.x===a(t)&&this.coordsOnMouseDown.y===u(t)&&(this._transform(this._computeNewPosition(1===this.direction?this.content.maxScale:this.content.minScale,{x:a(t),y:u(t)})),this.direction*=-1),this.coordsOnMouseDown=null}function w(n){var i=Math.round,o=Math.sqrt,s=Math.pow;if(2===n.targetTouches.length){var r=n.targetTouches[0].clientX,h=n.targetTouches[0].clientY,c=n.targetTouches[1].clientX,l=n.targetTouches[1].clientY,a=i(o(s(e(r-c),2)+s(e(h-l),2))),u=0;if(a>this.fingersHypot+5&&(u=-1),a<this.fingersHypot-5&&(u=1),0!==u){if(null!==this.fingersHypot||1===u){var p=new Event("wheel");p.deltaY=u,p.clientX=t(r,c)+e(r-c)/2,p.clientY=t(h,l)+e(h-l)/2,this._wheelHandler(p)}this.fingersHypot=a,this.zoomPinchWasDetected=!0}}}function v(){this.zoomPinchWasDetected&&(this.fingersHypot=null,this.zoomPinchWasDetected=!1)}return p.prototype={constructor:p,window:null,content:null,isTouch:!1,isGrab:!1,events:null,moveTimer:null,options:{},coordinates:null,speed:null,_grabHandler:function(t){(this.isTouch&&1===t.touches.length||1===t.buttons)&&(t.preventDefault(),this.isGrab=!0,this.coordinates={left:a(t),top:u(t)},this.speed={x:0,y:0},h(document,this.events.drop,this._dropHandler,this.events.options),h(document,this.events.move,this._moveHandler,this.events.options),"function"==typeof this.options.onGrab&&this.options.onGrab())},_dropHandler:function(t){t.preventDefault(),this.isGrab=!1,c(document,this.events.drop,this._dropHandler),c(document,this.events.move,this._moveHandler),"function"==typeof this.options.onDrop&&this.options.onDrop()},_moveHandler:function(t){if(this.isTouch&&1<t.touches.length)return!1;t.preventDefault();var n=this.window,i=this.content,o=this.speed,s=this.coordinates,r=this.options;o.x=a(t)-s.left,o.y=u(t)-s.top,clearTimeout(this.moveTimer),this.moveTimer=setTimeout((function(){o.x=0,o.y=0}),50);var h=i.currentLeft+o.x,c=i.currentTop+o.y,l=(i.currentWidth-n.originalWidth)/2+i.correctX,p=(i.currentHeight-n.originalHeight)/2+i.correctY;e(h)<=l&&(i.currentLeft=h),e(c)<=p&&(i.currentTop=c),function(t,e,n){var i=e.left,o=e.top,s=e.scale;n.smoothExtinction?t.style.transition="transform ".concat(n.smoothExtinction,"s"):t.style.removeProperty("transition"),t.style.transform="translate3d(".concat(i,"px, ").concat(o,"px, 0px) scale(").concat(s,")")}(i.$element,{left:i.currentLeft,top:i.currentTop,scale:i.currentScale},this.options),s.left=a(t),s.top=u(t),"function"==typeof r.onMove&&r.onMove()},destroy:function(){for(var t in c(this.content.$element,this.events.grab,this._grabHandler,this.events.options),this)this.hasOwnProperty(t)&&(this[t]=null)}},d.prototype={constructor:d,_init:function(){this._prepare(),this.isTouch&&(this.fingersHypot=null,this.zoomPinchWasDetected=!1,h(this.content.$element,"touchmove",this._zoomTwoFingers_TouchmoveHandler),h(this.content.$element,"touchend",this._zoomTwoFingers_TouchendHandler)),!0===this.options.dragScrollable&&(this.dragScrollable&&this.dragScrollable.destroy(),this.setDragScrollable(new p(this.window,this.content,this.options.dragScrollableOptions))),h(this.content.$element,"wheel",this._wheelHandler),this.options.zoomOnClick&&(h(this.content.$element,this.events.down,this._downHandler,this.events.options),h(this.content.$element,this.events.up,this._upHandler,this.events.options))},_prepare:function(){var e=s(this.window.$element);this.window.originalWidth=this.window.$element.offsetWidth,this.window.originalHeight=this.window.$element.offsetHeight,this.window.positionLeft=e.left,this.window.positionTop=e.top,"image"===this.options.type?(this.content.originalWidth=this.options.width||this.content.$element.naturalWidth,this.content.originalHeight=this.options.height||this.content.$element.naturalHeight):(this.content.originalWidth=this.options.width||this.content.$element.offsetWidth,this.content.originalHeight=this.options.height||this.content.$element.offsetHeight),this.content.minScale=this.options.minScale||t(this.window.originalWidth/this.content.originalWidth,this.window.originalHeight/this.content.originalHeight),this.content.maxScale=this.options.maxScale,this.content.currentWidth=this.content.originalWidth*this.content.minScale,this.content.currentHeight=this.content.originalHeight*this.content.minScale;var i=function(t,e,n){var i=0,o=0;switch(t.alignContent){case"left":i=(e.currentWidth-n.originalWidth)/2;break;case"top":o=(e.currentHeight-n.originalHeight)/2;break;case"right":i=(e.currentWidth-n.originalWidth)/2*-1;break;case"bottom":o=(e.currentHeight-n.originalHeight)/2*-1}return[i,o]}(this.options,this.content,this.window),o=n(i,2),r=o[0],h=o[1];this.content.alignPointX=r,this.content.alignPointY=h;var c=function(t,e,n){var i=Math.max,o=i(0,(n.originalWidth-e.currentWidth)/2),s=i(0,(n.originalHeight-e.currentHeight)/2);return"left"===t.alignContent?o*=2:"right"===t.alignContent&&(o=0),"bottom"===t.alignContent?s*=2:"top"===t.alignContent&&(s=0),[o,s]}(this.options,this.content,this.window),l=n(c,2),a=l[0],u=l[1];this.content.correctX=a,this.content.correctY=u,this.content.currentLeft=this.content.alignPointX,this.content.currentTop=this.content.alignPointY,this.content.currentScale=this.content.minScale,this.content.$element.style.transform="translate3d(".concat(this.content.alignPointX,"px, ").concat(this.content.alignPointY,"px, 0px) scale(").concat(this.content.minScale,")"),"function"==typeof this.options.prepare&&this.options.prepare()},_computeNewScale:function(t){this.direction=0>t?1:-1;var e=this.content,n=e.minScale,i=e.maxScale,o=e.currentScale+this.direction/this.options.speed;return o<n?this.direction=1:o>i&&(this.direction=-1),o<n?n:o>i?i:o},_computeNewPosition:function(t,n){var i=n.x,o=n.y,s=this.window,r=this.content,h=r.originalWidth*t,c=r.originalHeight*t,l=document,a=l.body,u=l.documentElement,p=s.pageXOffset||u.scrollLeft||a.scrollLeft,d=s.pageYOffset||u.scrollTop||a.scrollTop,m=i+p-s.positionLeft,f=s.originalWidth/2-m+r.currentLeft,g=f*(h/r.currentWidth)-f+r.currentLeft;if(-1===this.direction)switch(this.options.alignContent){case"left":h/2-g<s.originalWidth/2&&(g=(h-s.originalWidth)/2);break;case"right":h/2+g<s.originalWidth/2&&(g=(h-s.originalWidth)/2*-1);break;default:if((h-s.originalWidth)/2+r.correctX<e(g)){var w=0>g?-1:1;g=((h-s.originalWidth)/2+r.correctX)*w}}var v=o+d-s.positionTop,y=s.originalHeight/2-v+r.currentTop,_=y*(c/r.currentHeight)-y+r.currentTop;switch(this.options.alignContent){case"top":c/2-_<s.originalHeight/2&&(_=(c-s.originalHeight)/2);break;case"bottom":c/2+_<s.originalHeight/2&&(_=(c-s.originalHeight)/2*-1);break;default:if((c-s.originalHeight)/2+r.correctY<e(_)){var b=0>_?-1:1;_=((c-s.originalHeight)/2+r.correctY)*b}}t===this.content.minScale&&(g=this.content.alignPointX,_=this.content.alignPointY);var H={currentLeft:r.currentLeft,newLeft:g,currentTop:r.currentTop,newTop:_,currentScale:r.currentScale,newScale:t};return r.currentWidth=h,r.currentHeight=c,r.currentLeft=g,r.currentTop=_,r.currentScale=t,H},_transform:function(t){t.currentLeft;var e=t.newLeft;t.currentTop;var n=t.newTop;t.currentScale;var i=t.newScale;this.options.smoothExtinction?this.content.$element.style.transition="transform ".concat(this.options.smoothExtinction,"s"):this.content.$element.style.removeProperty("transition"),this.content.$element.style.transform="translate3d(".concat(e,"px, ").concat(n,"px, 0px) scale(").concat(i,")"),"function"==typeof this.options.rescale&&this.options.rescale()},_zoom:function(t){var e=s(this.window.$element),n=this.window,i=document,o=i.body,r=i.documentElement,h=n.pageXOffset||r.scrollLeft||o.scrollLeft,c=n.pageYOffset||r.scrollTop||o.scrollTop;this._transform(this._computeNewPosition(t,{x:e.left+this.window.originalWidth/2-h,y:e.top+this.window.originalHeight/2-c}))},prepare:function(){this._prepare()},zoomUp:function(){this._zoom(this._computeNewScale(-1))},zoomDown:function(){this._zoom(this._computeNewScale(1))},maxZoomUp:function(){this._zoom(this.content.maxScale)},maxZoomDown:function(){this._zoom(this.content.minScale)},setDragScrollable:function(t){this.dragScrollable=t},destroy:function(){for(var t in this.content.$element.style.transform="","image"===this.options.type&&c(this.content.$element,"load",this._init),this.isTouch&&(c(this.content.$element,"touchmove",this._zoomTwoFingers_TouchmoveHandler),c(this.content.$element,"touchend",this._zoomTwoFingers_TouchendHandler)),c(this.content.$element,"wheel",this._wheelHandler),this.options.zoomOnClick&&(c(this.content.$element,this.events.down,this._downHandler,this.events.options),c(this.content.$element,this.events.up,this._upHandler,this.events.options)),this.dragScrollable&&this.dragScrollable.destroy(),this)this.hasOwnProperty(t)&&(this[t]=null)}},d.create=function(t,e){return new d(t,e)},d}));